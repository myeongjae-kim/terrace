<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-126240406-1"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-126240406-1');</script><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico"><title>[Spring] Spring Bootì—ì„œ Repositoryë¡œ DynamoDB ì¡°ì‘í•˜ê¸° (1) - ì„¤ì •ë¶€í„° ì‹¤í–‰ê¹Œì§€ :: Myeongjae Kim</title><link href="/css/chunk-505caa8e.f5f5c4d4.css" rel="prefetch"><link href="/css/chunk-56479946.59ffc13f.css" rel="prefetch"><link href="/js/chunk-505caa8e.3fc3dac0.js" rel="prefetch"><link href="/js/chunk-56479946.1d7f29b9.js" rel="prefetch"><link href="/css/app.0ec34b52.css" rel="preload" as="style"><link href="/js/app.a9bc5983.js" rel="preload" as="script"><link href="/js/chunk-vendors.855aa201.js" rel="preload" as="script"><link href="/css/app.0ec34b52.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/css/chunk-505caa8e.f5f5c4d4.css"><script charset="utf-8" src="/js/chunk-505caa8e.3fc3dac0.js"></script><meta charset="utf-8" data-vue-meta="true"><meta property="og:image" content="https://avatars2.githubusercontent.com/u/15189621" data-vmid="og:image" data-vue-meta="true"><meta property="og:title" content="spring-data-dynamodb-1 :: Myeongjae Kim" data-vmid="og:title" data-vue-meta="true"><meta property="og:description" content="Thank you for reading my article ğŸ™ˆ" data-vmid="og:description" data-vue-meta="true"><script type="text/javascript" async="">var disqus_shortname  = "myeongjae";
var disqus_title      = "spring-data-dynamodb-1";
var disqus_identifier = "/2019/06/04/spring-data-dynamodb-1";
var disqus_url        = "https://blog.myeongjae.kim/2019/06/04/spring-data-dynamodb-1";
</script><script type="text/javascript" async="" src="//myeongjae.disqus.com/embed.js"></script><style type="text/css"></style></head><body><div id="app"><div id="site-title"><a href="/" class="mat-button no-shadow router-link-active">Myeongjae Kim</a></div><nav><a href="/" class="mat-button no-shadow router-link-active">About</a><a href="/blog/" class="mat-button no-shadow router-link-active router-link-exact-active">Blog</a><a href="/daily/" class="mat-button no-shadow">Daily</a><a href="/musings/" class="mat-button no-shadow">Musings</a><a href="/places/" class="mat-button no-shadow">Places</a></nav><div data-v-561bbc92="" id="blog"><div data-v-561bbc92="" id="blog-contents"><article data-v-561bbc92=""><div data-v-561bbc92="" class="inner-title-container"><h1 data-v-561bbc92=""><a data-v-561bbc92="" href="https://blog.myeongjae.kim/2019/06/04/spring-data-dynamodb-1" id="inner-title">[Spring] Spring Bootì—ì„œ Repositoryë¡œ DynamoDB ì¡°ì‘í•˜ê¸° (1) - ì„¤ì •ë¶€í„° ì‹¤í–‰ê¹Œì§€</a></h1><p data-v-561bbc92="" class="meta">2019 / 06 / 04</p></div><div data-v-561bbc92="" id="padding-between-title-and-article"></div><div data-v-561bbc92="" id="article-content"><h1 id="spring-spring-bootì—ì„œ-repositoryë¡œ-dynamodb-ì¡°ì‘í•˜ê¸°-1---ì„¤ì •ë¶€í„°-ì‹¤í–‰ê¹Œì§€" style="display: none;">[Spring] Spring Bootì—ì„œ Repositoryë¡œ DynamoDB ì¡°ì‘í•˜ê¸° (1) - ì„¤ì •ë¶€í„° ì‹¤í–‰ê¹Œì§€</h1>
<p>ì´ ê¸€ì—ì„œëŠ” DynamoDBë¥¼ ì¡°ì‘í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì„ ì˜ˆì œë¥¼ í†µí•´ ì†Œê°œí•©ë‹ˆë‹¤. aws cli -&gt; curl -&gt; AmazonDynamoDB í´ë˜ìŠ¤ -&gt; DynamoDBMapper í´ë˜ìŠ¤ -&gt; spring-data-dynamodb ìˆœì„œë¡œ ì§„í–‰í•˜ë‹ˆ, ë©”ì„œë“œ ì¿¼ë¦¬ë§Œ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ <a href="#spring-data-dynamodbë¡œ-ì¿¼ë¦¬-ë©”ì„œë“œ-ì‚¬ìš©í•˜ê¸°">spring-data-dynamodbë¡œ ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°</a>ë¶€í„° ë³´ì‹œë©´ ë©ë‹ˆë‹¤.</p>
<h2 id="ëª©ì°¨">ëª©ì°¨</h2>
<ul>
<li><a href="#dynamodbë¥¼-ì¨ì•¼-í•œë‹¤">DynamoDBë¥¼ ì¨ì•¼ í•œë‹¤!</a></li>
<li><a href="#dynamodbë¥¼-ì¨ë³´ì">DynamoDBë¥¼ ì¨ë³´ì</a>
<ul>
<li><a href="#aws-clië¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">aws clië¡œ DynamoDB ì¡°ì‘í•˜ê¸°</a>
<ul>
<li><a href="#í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</a></li>
<li><a href="#í•­ëª©-ì¶”ê°€">í•­ëª© ì¶”ê°€</a></li>
<li><a href="#í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</a></li>
<li><a href="#í•­ëª©-ìˆ˜ì •">í•­ëª© ìˆ˜ì •</a></li>
<li><a href="#í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</a></li>
<li><a href="#í…Œì´ë¸”-ì‚­ì œ">í…Œì´ë¸” ì‚­ì œ</a></li>
</ul></li>
<li><a href="#curlë¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">curlë¡œ DynamoDB ì¡°ì‘í•˜ê¸°</a>
<ul>
<li><a href="#í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</a></li>
<li><a href="#í•­ëª©-ì¶”ê°€">í•­ëª© ì¶”ê°€</a></li>
<li><a href="#í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</a></li>
<li><a href="#í•­ëª©-ìˆ˜ì •">í•­ëª© ìˆ˜ì •</a></li>
<li><a href="#í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</a></li>
<li><a href="#í…Œì´ë¸”-ì‚­ì œ">í…Œì´ë¸” ì‚­ì œ</a></li>
</ul></li>
<li><a href="#java-dynamodb-sdkë¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">Java DynamoDB SDKë¡œ DynamoDB ì¡°ì‘í•˜ê¸°</a>
<ul>
<li><a href="#í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</a></li>
<li><a href="#í•­ëª©-ì¶”ê°€">í•­ëª© ì¶”ê°€</a></li>
<li><a href="#í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</a></li>
<li><a href="#í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</a></li>
</ul></li>
<li><a href="#dynamodbmapperë¥¼-í™œìš©í•´-ê°ì²´-ë§¤í•‘í•˜ê¸°">DynamoDBMapperë¥¼ í™œìš©í•´ ê°ì²´ ë§¤í•‘í•˜ê¸°</a>
<ul>
<li><a href="#í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</a></li>
<li><a href="#entityì—-annotaiton-ì¶”ê°€í•˜ê¸°">Entityì— Annotaiton ì¶”ê°€í•˜ê¸°</a></li>
<li><a href="#í•­ëª©-ìƒì„±">í•­ëª© ìƒì„±</a></li>
<li><a href="#í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</a></li>
<li><a href="#í•­ëª©-ìˆ˜ì •">í•­ëª© ìˆ˜ì •</a></li>
<li><a href="#í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</a></li>
<li><a href="#í…Œì´ë¸”-ì‚­ì œ">í…Œì´ë¸” ì‚­ì œ</a></li>
</ul></li>
<li><a href="#spring-data-dynamodbë¡œ-ì¿¼ë¦¬-ë©”ì„œë“œ-ì‚¬ìš©í•˜ê¸°">spring-data-dynamodbë¡œ ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°</a>
<ul>
<li><a href="#í…Œì´ë¸”-ìƒì„±-ì‚­ì œ-ë°-í•­ëª©-ì¶”ê°€">í…Œì´ë¸” ìƒì„±, ì‚­ì œ ë° í•­ëª© ì¶”ê°€</a></li>
<li><a href="#í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</a></li>
<li><a href="#í•­ëª©-ìˆ˜ì •">í•­ëª© ìˆ˜ì •</a></li>
<li><a href="#í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</a></li>
<li><a href="#findallbymentionidorderbycreatedatasc-í…ŒìŠ¤íŠ¸">findAllByMentionIdOrderByCreatedAtAsc í…ŒìŠ¤íŠ¸</a></li>
</ul></li>
</ul></li>
</ul>
<h2 id="dynamodbë¥¼-ì¨ì•¼-í•œë‹¤">DynamoDBë¥¼ ì¨ì•¼ í•œë‹¤!</h2>
<p>íƒœì´ˆì— MongoDBë¡œ êµ¬í˜„í•œ APIê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì•„ì§ ê°œë°œì¤‘ì¸ ì‹œìŠ¤í…œì´ì§€ë§Œ í›—ë‚  ì˜ˆê²¬ë˜ëŠ” ìš´ì˜ìƒì˜ ì´ìœ ë¡œ ì¸í•´ MongoDBëŒ€ì‹  DynamoDBë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆê³ , í•´ë‹¹ APIì˜ ì°½ì¡°ìëŠ” ë‹¤ë¥¸ ì¼ ë•Œë¬¸ì— ë°”ë¹´ê³ , ê³µêµë¡­ê²Œë„ ì €ëŠ” ì§„í–‰í•˜ë˜ ì¼ì˜ ë§‰ë°”ì§€ ì‘ì—…ì„ í•˜ê³  ìˆì—ˆê³ , ë””ë²¨ë¡­ì— ë¨¸ì§€ë¥¼ í–ˆê³ , DynamoDBë¥¼ ê³µë¶€í•  ì¢‹ì€ ê¸°íšŒê°€ ì£¼ì–´ì¡ŒìŠµë‹ˆë‹¤. ì™€!</p>
<p><a href="https://github.com/derjust/spring-data-dynamodb">spring-data-dynamodb</a>ë¼ëŠ” spring-data ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆì—ˆê³  ì´ë¥¼ í™œìš©í•œ ì˜ˆì œë“¤ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆì§€ë§Œ, DynamoDB SDKê°€ ë¹ ë¥´ê²Œ ì—…ë°ì´íŠ¸ë˜ê³  ìˆë˜ ì‹œê¸°ë¼ì„œ ì˜ˆì œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜ì–´ë¡œ ëœ ì •ë³´ë“¤ë„ íŒŒí¸í™”ë˜ì–´ìˆì—ˆê³  í•œêµ­ì–´ë¡œ ëœ ì •ë³´ë“¤ì€ ë”ë”ìš± ì°¾ê¸° í˜ë“¤ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì €ëŠ” <a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9788960777330&amp;orderClick=LEA&amp;Kc=">ì„¸ê³„ ìµœê³  ORM ì…ë¬¸ì„œ</a>ë¥¼ ê³µë¶€í–ˆê¸° ë•Œë¬¸ì— ê¼­ DynamoDBë¥¼ ê°ì²´ ë§¤í•‘ê³¼ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì“°ê³ ì‹¶ì—ˆìŠµë‹ˆë‹¤.</p>
<p>ê¸€ì„ ì“°ê¸° ìœ„í•´ì„œ <a href="https://github.com/myeongjae-kim/guestbook">í† ì´í”„ë¡œì íŠ¸</a>ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. í¬ë¹„ ë°•ì¬ì„±ë‹˜ì˜ <a href="https://www.facebook.com/woowahanTech/photos/a.1925530564354206/2269703193270273/?type=3&amp;theater">TDD ì„¸ë¯¸ë‚˜</a>ì—ì„œ ë“¤ì€ ë‚´ìš©ìœ¼ë¡œ TDDë¥¼ ê°•ë°•ì ìœ¼ë¡œ ì ìš©í–ˆê³ , ê¹€ë¯¼íƒœë‹˜ì˜ <a href="https://www.facebook.com/woowahanTech/posts/2274019452838647">React &amp; TypeScript 101</a>ì—ì„œ ê³µë¶€í•œ ê²ƒë“¤ë¡œ UIë„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</p>
<p style="text-align: center">
<img src="https://cdn.myeongjae.kim/blog/2019/06/guestbook.gif" alt="ë‹¬í† ë¼ëŠ” ë°©ëª…ë¡ì´ ê°–ê³ ì‹¶ì—ˆë‹¤!" width="480">
</p>
<p>ê°„ë‹¨í•œ ë°©ëª…ë¡ì¸ë°ìš”, ê¸°ë¡(Mention)ì„ ë‚¨ê¸¸ ìˆ˜ ìˆê³  ê¸°ë¡ì— ëŒ€í•œ ëŒ“ê¸€(Comment)ë„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë¡ì€ SQL DBMS(embedded h2)ë¡œ, ëŒ“ê¸€ì€ NoSQL DB(Dynamo DB)ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. <a href="https://github.com/myeongjae-kim/guestbook/tree/before-dynamodb">ì´ ë¸Œëœì¹˜</a>ëŠ” ê¸°ë¡ APIê°€ ì™„ì„±ëœ ìƒíƒœê³ , ëŒ“ê¸€ APIëŠ” ì €ì¥ì†Œ(Repository) ë ˆì´ì–´ë§Œ êµ¬í˜„í•´ì„œ DBì™€ ì—°ê²°í•´ì£¼ê¸°ë§Œ í•˜ë©´ ì‘ë™í•©ë‹ˆë‹¤. ì¼ë‹¨ ê¸°ë¡ APIì™€ ì›¹ì•±ë§Œ ì‹¤í–‰í•´ë´…ì‹œë‹¤. ê°œë°œí™˜ê²½ì€ macOS 10.14, Java 1.8, node v10.12, Javaì—ì„œ IntelliJ, TypeScriptì—ì„œ VS Codeë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
<pre class="bash"><code class="hljs">git <span class="hljs-built_in">clone</span> -b before-dynamodb --single-branch https://github.com/myeongjae-kim/guestbook.git

<span class="hljs-comment"># guestbook/guestbook-api</span>
./gradlew :guestbook-api-mentions:bootRun

<span class="hljs-comment"># guestbook/guestbook-webapp</span>
npm install; npm start;</code></pre>
<script id="asciicast-249649" src="https://asciinema.org/a/249649.js" async=""></script>
<p>ëŒ“ê¸€ ì €ì¥ì†Œë¥¼ êµ¬í˜„í•˜ê¸° ì „ì— ë¨¼ì € DynamoDBë¥¼ ì–´ë–»ê²Œ ì“°ëŠ”ì§€ë¶€í„° ì•Œì•„ë´ì•¼ê² ìŠµë‹ˆë‹¤.</p>
<h2 id="dynamodbë¥¼-ì¨ë³´ì">DynamoDBë¥¼ ì¨ë³´ì</h2>
<p><a href="https://aws.amazon.com/ko/dynamodb/">Amazon DynamoDBëŠ” ì–´ë–¤ ê·œëª¨ì—ì„œë„ 10ë°€ë¦¬ì´ˆ ë¯¸ë§Œì˜ ì„±ëŠ¥ì„ ì œê³µí•˜ëŠ” í‚¤-ê°’ ë° ë¬¸ì„œ ë°ì´í„°ë² ì´ìŠ¤ì…ë‹ˆë‹¤. DynamoDBëŠ” í•˜ë£¨ì— 10ì¡° ê°œ ì´ìƒì˜ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê³ , ì´ˆë‹¹ 2,000ë§Œ ê°œ ì´ìƒì˜ í”¼í¬ ìš”ì²­ì„ ì§€ì›í•  ìˆ˜ ìˆ</a>ë‹¤ê³  í•˜ì§€ë§Œ, ë‹¬ ë°©ëª…ë¡ì— ê·¸ë ‡ê²Œ ë§ì€ ì‚¬ëŒì´ ê¸°ë¡ì„ ë‚¨ê¸¸ ê²ƒ ê°™ì§„ ì•ŠìŠµë‹ˆë‹¤. SQL DBì™€ì˜ ë¹„êµëŠ” <a href="https://aws.amazon.com/ko/nosql/">ì—¬ê¸°</a>ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>DynamoDBë¥¼ ì¿¼ë¦¬ ë©”ì„œë“œë¡œ ì¡°ì‘í•˜ê¸°ê¹Œì§€ ê±°ì¹˜ëŠ” ë ˆì´ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<figure>
<img src="https://cdn.myeongjae.kim/blog/2019/06/dynamodb-accessing-layer.png" alt="DynamoDB Accessing Layer"><figcaption>DynamoDB Accessing Layer</figcaption>
</figure>
<p>ìœ„ì—ì„œ ë§ì”€ë“œë¦° ê²ƒì²˜ëŸ¼ aws cli -&gt; curl -&gt; AmazonDynamoDB í´ë˜ìŠ¤ -&gt; DynamoDBMapper í´ë˜ìŠ¤ -&gt; spring-data-dynamodb ìˆœì„œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.</p>
<p>DynamoDBë¥¼ ë¡œì»¬ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <a href="https://aws.amazon.com/ko/cli/">aws cli</a>ì™€ <a href="https://hub.docker.com/r/amazon/dynamodb-local/">DynamoDB ë„ì»¤ ì´ë¯¸ì§€</a>ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë„ì»¤ë¥¼ ì„¤ì¹˜í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ DynamoDBë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤.</p>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
docker pull amazon/dynamodb-local
docker run -p 8000:8000 amazon/dynamodb-local -jar DynamoDBLocal.jar -inMemory -sharedDb</code></pre>
<p>í¬íŠ¸ 8000ë²ˆì— ë¡œì»¬ DynamoDBë¥¼ ë„ì›ë‹ˆë‹¤. <code class="hljs">-inMemory</code> ì˜µì…˜ì„ ì£¼ë©´ DBë¥¼ ì¢…ë£Œí•  ë•Œ DBì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚¬ë¼ì§€ê³ , <code class="hljs">-sharedDb</code> ì˜µì…˜ì„ ì£¼ë©´ requestì˜ regionì´ ë‹¤ë¥´ë”ë¼ë„ ê°™ì€ ê³µê°„ì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<h3 id="aws-clië¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">aws clië¡œ DynamoDB ì¡°ì‘í•˜ê¸°</h3>
<h4 id="í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</h4>
<p><a href="https://aws.amazon.com/ko/cli/">aws cli</a>ë¡œ í…Œì´ë¸”ì„ ìƒì„±í•´ë´…ì‹œë‹¤.</p>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb create-table \
    --endpoint-url http://localhost:8000 \
    --table-name Comment \
    --attribute-definitions \
        AttributeName=id,AttributeType=S \
        AttributeName=mentionId,AttributeType=N \
        AttributeName=createdAt,AttributeType=S \
    --key-schema AttributeName=id,KeyType=HASH \
    --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1 \
    --global-secondary-indexes IndexName=byMentionId,\
KeySchema=[<span class="hljs-string">"{\
  AttributeName=mentionId,\
  KeyType=HASH\
}"</span>,<span class="hljs-string">"{\
  AttributeName=createdAt,\
  KeyType=RANGE\
}"</span>],\
Projection=<span class="hljs-string">"{ProjectionType=ALL}"</span>,\
ProvisionedThroughput=<span class="hljs-string">"{\
  ReadCapacityUnits=1,\
  WriteCapacityUnits=1\
}"</span></code></pre>
<p>ìƒì„±ì´ ì˜ ëë‚˜ìš”? ìœ„ ìŠ¤í‚¤ë§ˆëŠ” ëŒ“ê¸€ í´ë˜ìŠ¤ì— ìƒì‘í•©ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Comment {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> id;
    <span class="hljs-keyword">private</span> Integer mentionId;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> content;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> deleted;
    <span class="hljs-keyword">private</span> LocalDateTime createdAt;
    <span class="hljs-keyword">private</span> LocalDateTime deletedAt;
}</code></pre>
<p>ëŒ“ê¸€ì˜ í•„ë“œëŠ” 7ê°œì¸ë°, ìœ„ì˜ ëª…ë ¹ì—ì„œëŠ” attirbuteë¥¼ <code class="hljs">id</code>, <code class="hljs">mentionId</code>, <code class="hljs">createdAt</code> 3ê°œë§Œ ì •ì˜í•©ë‹ˆë‹¤. ë§ˆì¹˜ JavaScriptì˜ JSONì²˜ëŸ¼ ì •ì˜í•˜ì§€ ì•Šì€ í•„ë“œì— ê°’ì„ ë„£ì–´ë„ ì˜ ë“¤ì–´ê°‘ë‹ˆë‹¤â€¦ ë™ì  ìŠ¤í‚¤ë§ˆëŠ” NoSQL DBì˜ íŠ¹ì§•ì…ë‹ˆë‹¤. keyì— ëŒ€í•´ì„œë§Œ ì •ì˜ë¥¼ í•´ì£¼ë©´ ë©ë‹ˆë‹¤. ëŒ“ê¸€ì€ 3ê°œì˜ keyë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, <code class="hljs">id</code>ëŠ” primary Key, <code class="hljs">mentionId</code>ì™€ <code class="hljs">createdAt</code>ì€ secondary indexì˜ keyì…ë‹ˆë‹¤. Secondary indexë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì„ì˜ì˜ ê¸°ë¡ì— ë‹¬ë¦° ëŒ“ê¸€ì„ ì‹œê°„ìˆœì„œëŒ€ë¡œ ì •ë ¬í•´ì„œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì¿¼ë¦¬ë¥¼ ë³´ë©´ í…Œì´ë¸”ê³¼ secondary indexì— ProvisionedThroughputì´ ì •ì˜ëœ ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ProvisionedThroughputì— ëŒ€í•œ AWSì˜ ì„¤ëª…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>í”„ë¡œë¹„ì €ë‹ëœ ëª¨ë“œ</p>
<p>í”„ë¡œë¹„ì €ë‹ëœ ëª¨ë“œë¥¼ ì„ íƒí•œ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ ì´ˆë‹¹ ì½ê¸° ë° ì“°ê¸° íšŸìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. Auto Scalingì„ ì‚¬ìš©í•˜ì—¬ íŠ¸ë˜í”½ ë³€ê²½ì— ë”°ë¼ í…Œì´ë¸”ì˜ í”„ë¡œë¹„ì €ë‹ëœ ìš©ëŸ‰ì„ ìë™ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ DynamoDB ì‚¬ìš©ì„ ì •ì˜ëœ ìš”ì²­ ì†ë„ ì´í•˜ë¡œ ìœ ì§€í•˜ë„ë¡ ê´€ë¦¬í•˜ì—¬ ë¹„ìš©ì„ ì˜ˆì¸¡í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
<p>í”„ë¡œë¹„ì €ë‹ëœ ëª¨ë“œëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì— í•´ë‹¹ë˜ëŠ” ê²½ìš°ì— ìœ ìš©í•œ ì˜µì…˜ì…ë‹ˆë‹¤.</p>
<ul>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ íŠ¸ë˜í”½ì´ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ê²½ìš°</li>
<li>íŠ¸ë˜í”½ì´ ì¼ê´€ë˜ê±°ë‚˜ ì ì§„ì ìœ¼ë¡œ ë³€í™”í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ê²½ìš°</li>
<li>ë¹„ìš© ê´€ë¦¬ë¥¼ ìœ„í•´ ìš©ëŸ‰ ìš”êµ¬ ì‚¬í•­ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°</li>
</ul>
<p>- <a href="https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/HowItWorks.ReadWriteCapacityMode.html">ì½ê¸°/ì“°ê¸° ìš©ëŸ‰ ëª¨ë“œ</a></p>
</blockquote>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì„±ê³¼ í™˜ê²½ì— ë”°ë¼ ProvisionedThroughputì„ ì¡°ì ˆí•´ì•¼ í•˜ì§€ë§Œ, ë¡œì»¬ DyanmoDBëŠ” ProvisionedThroughputê³¼ ìƒê´€ì—†ì´ ì‘ë™í•˜ë‹ˆ ì¼ë‹¨ 1ì„ ì¤ì‹œë‹¤. ì´ë ‡ê²Œ Primary keyì™€ secondary indexì— ëŒ€í•œ ProvisionedThroughputì„ ì •ì˜í•´ì•¼ í…Œì´ë¸”ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ secondary indexì— <code class="hljs bash">Projection=<span class="hljs-string">"{ProjectionType=ALL}"</span></code> ì˜µì…˜ì„ ì¤Œìœ¼ë¡œì¨ secondary indexë¥¼ í†µí•´ ì•„ì´í…œì„ ì¡°íšŒí•  ë•Œë„ ëª¨ë“  í•„ë“œë¥¼ ì¶œë ¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì¶”ê°€">í•­ëª© ì¶”ê°€</h4>
<p>DynamoDBì—ì„œëŠ” SQL DBì˜ ë ˆì½”ë“œ(í˜¹ì€ row, í˜¹ì€ íŠœí”Œ)ì„ í•­ëª©(item)ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ëŒ“ê¸€ í•˜ë‚˜ë¥¼ ì¶”ê°€í•´ë´…ì‹œë‹¤.</p>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb put-item \
    --endpoint-url http://localhost:8000 \
    --table-name Comment \
    --item <span class="hljs-string">'{
        "id": {"S": "uuid"},
        "name": {"S": "name"},
        "mentionId": {"N": "1"},
        "content" : {"S": "comment content"},
        "deleted" : {"BOOL": false},
        "createdAt": {"S": "1836-03-07T02:21:30.536Z"}
    }'</span></code></pre>
<p>í•­ëª© ì¶”ê°€ì— ì„±ê³µí•˜ë©´ 0ì„ ë¦¬í„´í•©ë‹ˆë‹¤. ì¶”ê°€í•œ í•­ëª©ì„ ì¡°íšŒí•˜ëŠ” ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì¡°íšŒ">í•­ëª© ì¡°íšŒ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb get-item \
    --endpoint-url http://localhost:8000 \
    --table-name Comment \
    --key <span class="hljs-string">'{"id":{"S":"uuid"}}'</span></code></pre>
<h4 id="í•­ëª©-ìˆ˜ì •">í•­ëª© ìˆ˜ì •</h4>
<p>í•­ëª©ì„ ìˆ˜ì •í•  ë•ŒëŠ” ì¶”ê°€í•  ë•Œì™€ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb put-item \
    --endpoint-url http://localhost:8000 \
    --table-name Comment \
    --item <span class="hljs-string">'{
        "id": {"S": "uuid"},
        "name": {"S": "name"},
        "mentionId": {"N": "1"},
        "content" : {"S": "modified comment content"},
        "deleted" : {"BOOL": false},
        "createdAt": {"S": "1836-03-07T02:21:30.536Z"}
    }'</span></code></pre>
<h4 id="í•­ëª©-ì‚­ì œ">í•­ëª© ì‚­ì œ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb delete-item \
    --endpoint-url http://localhost:8000 \
    --table-name Comment \
    --key <span class="hljs-string">'{"id":{"S":"uuid"}}'</span></code></pre>
<h4 id="í…Œì´ë¸”-ì‚­ì œ">í…Œì´ë¸” ì‚­ì œ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
aws dynamodb delete-table \
    --endpoint-url http://localhost:8000 \
    --table-name Comment</code></pre>
<p>aws cliì— ì˜ì¡´í•˜ì§€ ì•Šê³  DynamoDBë¥¼ ì¡°ì‘í•  ìˆ˜ëŠ” ì—†ì„ê¹Œìš”? ì‚¬ì‹¤ aws clië¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ì¢…êµ­ì—ëŠ” DBì™€ í†µì‹ í•˜ê¸° ìœ„í•´ httpì˜ post methodë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ë™ì¹˜ì˜ ëª…ë ¹ì„ curl requestë¡œ ë‚ ë ¤ë´…ì‹œë‹¤.</p>
<h3 id="curlë¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">curlë¡œ DynamoDB ì¡°ì‘í•˜ê¸°</h3>
<h4 id="í…Œì´ë¸”-ìƒì„±-1">í…Œì´ë¸” ìƒì„±</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.CreateTable'</span> \
  -d <span class="hljs-string">'{
    "AttributeDefinitions": [
        {
            "AttributeName": "id",
            "AttributeType": "S"
        },
        {
            "AttributeName": "mentionId",
            "AttributeType": "N"
        },
        {
            "AttributeName": "createdAt",
            "AttributeType": "S"
        }
    ],
    "TableName": "Comment",
    "KeySchema": [
        {
            "AttributeName": "id",
            "KeyType": "HASH"
        }
    ],
    "GlobalSecondaryIndexes": [
        {
            "IndexName": "byMentionId",
            "KeySchema": [
                {
                    "AttributeName": "mentionId",
                    "KeyType": "HASH"
                },
                {
                    "AttributeName": "createdAt",
                    "KeyType": "RANGE"
                }
            ],
            "Projection": {
                "ProjectionType": "ALL"
            },
            "ProvisionedThroughput": {
                "ReadCapacityUnits": 1,
                "WriteCapacityUnits": 1
            }
        }
    ],
    "ProvisionedThroughput": {
        "ReadCapacityUnits": 1,
        "WriteCapacityUnits": 1
    }
}'</span></code></pre>
<p>Authorization headerì—ì„œ, <code class="hljs">Credential=key1/20190526/ap-northeast-2</code> ì— <code class="hljs">/</code> 2ê°œë¡œ êµ¬ë¶„í•œ ì„ì˜ì˜ ê°’ì„ ë„£ì–´ë„ ë¡œì»¬ DynamoDBëŠ” ë™ì‘í•©ë‹ˆë‹¤. <code class="hljs">Credential=a/b/c</code>ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì¶”ê°€-1">í•­ëª© ì¶”ê°€</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.PutItem'</span> \
  -d <span class="hljs-string">'{
    "TableName":"Comment",
    "Item":{
        "id": {"S": "uuid"},
        "mentionId": {"N": "1"},
        "content" : {"S": "comment content"},
        "deleted" : {"BOOL": "false"},
        "createdAt": {"S": "1836-03-07T02:21:30.536Z"}
    }
}'</span></code></pre>
<h4 id="í•­ëª©-ì¡°íšŒ-1">í•­ëª© ì¡°íšŒ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.GetItem'</span> \
  -d <span class="hljs-string">'{
    "TableName": "Comment",
    "Key": {
        "id": {"S": "uuid"}
    }
}'</span></code></pre>
<h4 id="í•­ëª©-ìˆ˜ì •-1">í•­ëª© ìˆ˜ì •</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.PutItem'</span> \
  -d <span class="hljs-string">'{
    "TableName":"Comment",
    "Item":{
        "id": {"S": "uuid"},
        "mentionId": {"N": "1"},
        "content" : {"S": "modified comment content"},
        "deleted" : {"BOOL": "false"},
        "createdAt": {"S": "1836-03-07T02:21:30.536Z"}
    }
}'</span>
</code></pre>
<h4 id="í•­ëª©-ì‚­ì œ-1">í•­ëª© ì‚­ì œ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.DeleteItem'</span> \
  -d <span class="hljs-string">'{
    "TableName":"Comment",
    "Key":{
        "id": {"S": "uuid"}
    }
}'</span></code></pre>
<h4 id="í…Œì´ë¸”-ì‚­ì œ-1">í…Œì´ë¸” ì‚­ì œ</h4>
<pre class="bash"><code class="hljs"><span class="hljs-meta">#!/usr/bin/env bash
</span>
curl -X POST \
  http://localhost:8000/ \
  -H <span class="hljs-string">'Authorization: AWS4-HMAC-SHA256 Credential=key1/20190526/ap-northeast-2'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -H <span class="hljs-string">'X-Amz-Target: DynamoDB_20120810.DeleteTable'</span> \
  -d <span class="hljs-string">'{
    "TableName":"Comment"
}'</span></code></pre>
<p>aws cliì— ì˜ì¡´í•˜ì§€ ì•Šê³  ë¡œì»¬ DynamoDBì™€ í†µì‹ í–ˆìŠµë‹ˆë‹¤. aws clië¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì—ì„œ ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p>
<p>ì´ë²ˆì—ëŠ” Java DynamoDB SDKë¥¼ í†µí•´ì„œ DynamoDBë¥¼ ì¡°ì‘í•´ë´…ì‹œë‹¤.</p>
<h3 id="java-dynamodb-sdkë¡œ-dynamodb-ì¡°ì‘í•˜ê¸°">Java DynamoDB SDKë¡œ DynamoDB ì¡°ì‘í•˜ê¸°</h3>
<p><code class="hljs">guestbook-api-comments/build.gradle</code>ì˜ <code class="hljs">dependencies</code>ì— <code class="hljs bash">implementation <span class="hljs-string">"com.amazonaws:aws-java-sdk-dynamodb:1.11.563"</span></code>ì„ ì¶”ê°€í•˜ê³ , <code class="hljs bash">guestbook-api-comments/src/<span class="hljs-built_in">test</span>/java/guestbook/comments/AwsDynamoDbSdkTestToLearn.java</code> í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
<p><em>(ì´í•˜ì˜ í…ŒìŠ¤íŠ¸ë“¤ì€ <strong>JUnit5</strong>ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.)</em></p>
<pre class="java"><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsDynamoDbSdkTestToLearn</span> {</span>
    <span class="hljs-keyword">private</span> AmazonDynamoDB amazonDynamoDb;

    @<span class="hljs-function">BeforeEach
    <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
        AWSCredentials awsCredentials = <span class="hljs-keyword">new</span> BasicAWSCredentials(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"key2"</span>);
        AWSCredentialsProvider awsCredentialsProvider = <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(awsCredentials);
        EndpointConfiguration endpointConfiguration = <span class="hljs-keyword">new</span> EndpointConfiguration(<span class="hljs-string">"http://localhost:8000"</span>, <span class="hljs-string">"ap-northeast-2"</span>);

        amazonDynamoDb = AmazonDynamoDBClientBuilder.standard()
                .withCredentials(awsCredentialsProvider)
                  .withEndpointConfiguration(endpointConfiguration).build();;
    }
}</code></pre>
<p>ë§¤ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ DB Clientê°ì²´ë¥¼ ìƒì„±í•˜ê²Œ í•˜ê³ , ìœ„ì—ì„œ í–ˆë˜ ê²ƒê³¼ ê°™ì€ ì‘ì—…ì„ í•´ë´…ì‹œë‹¤.</p>
<h4 id="í…Œì´ë¸”-ìƒì„±-2">í…Œì´ë¸” ìƒì„±</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> createTable_ValidInput_TableHasBeenCreated() {
    CreateTableRequest createTableRequest = (<span class="hljs-keyword">new</span> CreateTableRequest())
            .withAttributeDefinitions(
                    <span class="hljs-keyword">new</span> AttributeDefinition(<span class="hljs-string">"id"</span>, ScalarAttributeType.S),
                    <span class="hljs-keyword">new</span> AttributeDefinition(<span class="hljs-string">"mentionId"</span>, ScalarAttributeType.N),
                    <span class="hljs-keyword">new</span> AttributeDefinition(<span class="hljs-string">"createdAt"</span>, ScalarAttributeType.S)
            ).withTableName(<span class="hljs-string">"Comment"</span>).withKeySchema(
                    <span class="hljs-keyword">new</span> KeySchemaElement(<span class="hljs-string">"id"</span>, KeyType.HASH)
            ).withGlobalSecondaryIndexes(
                    (<span class="hljs-keyword">new</span> GlobalSecondaryIndex())
                            .withIndexName(<span class="hljs-string">"byMentionId"</span>)
                            .withKeySchema(
                                    <span class="hljs-keyword">new</span> KeySchemaElement(<span class="hljs-string">"mentionId"</span>, KeyType.HASH),
                                    <span class="hljs-keyword">new</span> KeySchemaElement(<span class="hljs-string">"createdAt"</span>, KeyType.RANGE))
                            .withProjection(
                                    (<span class="hljs-keyword">new</span> Projection()).withProjectionType(ProjectionType.ALL))
                            .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1</span>L, <span class="hljs-number">1</span>L))
            ).withProvisionedThroughput(
                    <span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1</span>L, <span class="hljs-number">1</span>L)
            );

    <span class="hljs-built_in">boolean</span> hasTableBeenCreated = TableUtils.createTableIfNotExists(amazonDynamoDb, createTableRequest);
    then(hasTableBeenCreated).isTrue();
}</code></pre>
<p>ì—¬ê¸°ì„œ ì‘ì„±í•  í…ŒìŠ¤íŠ¸ë“¤ì€ AWS SDKì˜ ì‚¬ìš©ë²•ì„ ìµíˆê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ë“¤ë¡œ apië¥¼ ìœ„í•œ í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— <code class="hljs typescript"><span class="hljs-meta">@Diasbled</span></code>ë¥¼ ë¶™ì˜€ìŠµë‹ˆë‹¤. <code class="hljs typescript"><span class="hljs-meta">@Disabled</span></code>ë¥¼ ë¶™ì´ë©´ gradleì„ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•ŒëŠ” í•´ë‹¹ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì§€ë§Œ, IDEì—ì„œ ê°œë³„ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì¶”ê°€-2">í•­ëª© ì¶”ê°€</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> putItem_ShouldBeCalledAfterTableCreation_StatusOk() {
    Map&lt;<span class="hljs-built_in">String</span>, AttributeValue&gt; item = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    item.put(<span class="hljs-string">"id"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"uuid"</span>));
    item.put(<span class="hljs-string">"mentionId"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withN(<span class="hljs-string">"1"</span>));
    item.put(<span class="hljs-string">"content"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"comment content"</span>));
    item.put(<span class="hljs-string">"deleted"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withBOOL(<span class="hljs-literal">false</span>));
    item.put(<span class="hljs-string">"createdAt"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"1836-03-07T02:21:30.536Z"</span>));

    PutItemRequest putItemRequest = (<span class="hljs-keyword">new</span> PutItemRequest())
            .withTableName(<span class="hljs-string">"Comment"</span>)
            .withItem(item);

    PutItemResult putItemResult = amazonDynamoDb.putItem(putItemRequest);
    then(putItemResult.getSdkHttpMetadata().getHttpStatusCode()).isEqualTo(<span class="hljs-number">200</span>);
}</code></pre>
<p>ì´ í…ŒìŠ¤íŠ¸ëŠ” DynamoDBì— Comment í…Œì´ë¸”ì´ ì—†ëŠ” ìƒíƒœë¡œ ì‹¤í–‰í•˜ë©´ ì‹¤íŒ¨í•˜ê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë“¤ì´ ì„œë¡œ ì˜ì¡´í•˜ë©´ ì•ˆë˜ì§€ë§Œ ì´ í…ŒìŠ¤íŠ¸ë“¤ì€ í…ŒìŠ¤íŠ¸ ìŠˆíŠ¸ì— í¬í•¨ë˜ì§€ ì•Šê³  ê°œë³„ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•´ì•¼ í•˜ë¯€ë¡œ, í…ŒìŠ¤íŠ¸ ì´ë¦„ì— ì‹œê°„ì  ì˜ì¡´ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œí•´ì„œ ì •ë‹¹í™”ë¥¼ í–ˆìŠµë‹ˆë‹¤.</p>
<p><code class="hljs">item</code>ë§µ ê°™ì€ ê²½ìš° ì´í›„ì— í•­ëª© ì¡°íšŒì—ì„œë„ ì“°ì´ë¯€ë¡œ ë©”ì„œë“œ ë°–ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ì˜®ê²¼ìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsDynamoDbSdkTestToLearn</span> {</span>
  <span class="hljs-keyword">private</span> AmazonDynamoDB amazonDynamoDb;
  <span class="hljs-keyword">private</span> Map&lt;String, AttributeValue&gt; item;

  @<span class="hljs-function">BeforeEach
  <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
      AWSCredentials awsCredentials = <span class="hljs-keyword">new</span> BasicAWSCredentials(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"key2"</span>);
      AWSCredentialsProvider awsCredentialsProvider = <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(awsCredentials);

      amazonDynamoDb = AmazonDynamoDBClientBuilder.standard()
              .withCredentials(awsCredentialsProvider)
              .withEndpointConfiguration(
                      <span class="hljs-keyword">new</span> AwsClientBuilder.EndpointConfiguration(<span class="hljs-string">"http://localhost:8000"</span>, <span class="hljs-string">"ap-northeast-2"</span>))
              .build();

      item = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
      item.put(<span class="hljs-string">"id"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"uuid"</span>));
      item.put(<span class="hljs-string">"mentionId"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withN(<span class="hljs-string">"1"</span>));
      item.put(<span class="hljs-string">"content"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"comment content"</span>));
      item.put(<span class="hljs-string">"deleted"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withBOOL(<span class="hljs-literal">false</span>));
      item.put(<span class="hljs-string">"createdAt"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"to be changed"</span>));
      item.put(<span class="hljs-string">"deletedAt"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"to be changed"</span>));
  }
...</code></pre>
<h4 id="í•­ëª©-ì¡°íšŒ-2">í•­ëª© ì¡°íšŒ</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> getItem_ShouldBeCalledAfterPuttingItem_FoundItem() {
    Map&lt;<span class="hljs-built_in">String</span>, AttributeValue&gt; key = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    key.put(<span class="hljs-string">"id"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"uuid"</span>));

    GetItemRequest getItemRequest = (<span class="hljs-keyword">new</span> GetItemRequest())
            .withTableName(<span class="hljs-string">"Comment"</span>)
            .withKey(key);

    GetItemResult getItemResult = amazonDynamoDb.getItem(getItemRequest);

    then(getItemResult.getItem()).containsAllEntriesOf(item);
}</code></pre>
<p>í•­ëª© ì¡°íšŒ í…ŒìŠ¤íŠ¸ëŠ” í•­ëª© ìƒì„± í…ŒìŠ¤íŠ¸ ì´í›„ì— ì‹¤í–‰í•´ì•¼ í†µê³¼í•©ë‹ˆë‹¤. ì¡°íšŒí•œ í•­ëª©ì˜ ê°’ë“¤ì´ ìƒì„±í•  ë•Œ ì“°ì¸ í•­ëª©ì˜ ê°’ë“¤ê³¼ ê°™ìœ¼ë©´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•©ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì‚­ì œ-2">í•­ëª© ì‚­ì œ</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> deleteItem_ShouldBeCalledAfterPuttingItem_StatsOk() {
    Map&lt;<span class="hljs-built_in">String</span>, AttributeValue&gt; key = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    key.put(<span class="hljs-string">"id"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"uuid"</span>));

    DeleteItemRequest deleteItemRequest = (<span class="hljs-keyword">new</span> DeleteItemRequest())
            .withTableName(<span class="hljs-string">"Comment"</span>)
            .withKey(key);

    DeleteItemResult deleteItemResult = amazonDynamoDb.deleteItem(deleteItemRequest);

    then(deleteItemResult.getSdkHttpMetadata().getHttpStatusCode()).isEqualTo(<span class="hljs-number">200</span>);
}</code></pre>
<p>í•­ëª©ì„ ìƒì„±í•œ ë’¤ ì‚­ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•©ë‹ˆë‹¤. í•­ëª©ì´ ì˜ ì‚­ì œëëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> getItem_ShouldBeCalledAfterDeletingItem_NullItem() {
    Map&lt;<span class="hljs-built_in">String</span>, AttributeValue&gt; key = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    key.put(<span class="hljs-string">"id"</span>, (<span class="hljs-keyword">new</span> AttributeValue()).withS(<span class="hljs-string">"uuid"</span>));

    GetItemRequest getItemRequest = (<span class="hljs-keyword">new</span> GetItemRequest())
            .withTableName(<span class="hljs-string">"Comment"</span>)
            .withKey(key);

    GetItemResult getItemResult = amazonDynamoDb.getItem(getItemRequest);

    then(getItemResult.getItem()).isNull();
}</code></pre>
<h3 id="dynamodbmapperë¥¼-í™œìš©í•´-ê°ì²´-ë§¤í•‘í•˜ê¸°">DynamoDBMapperë¥¼ í™œìš©í•´ ê°ì²´ ë§¤í•‘í•˜ê¸°</h3>
<p>DynamoDBMapperëŠ” Java DynamoDB SDKì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´-í…Œì´ë¸” ë§¤í•‘ ë„êµ¬ì…ë‹ˆë‹¤. ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, DynamoDBMapperë¥¼ ìµíˆê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. <code class="hljs bash">guestbook-api-comments/src/<span class="hljs-built_in">test</span>/java/guestbook/comments/DynamoDbMapperTestToLearn.java</code> í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
<h4 id="í…Œì´ë¸”-ìƒì„±-3">í…Œì´ë¸” ìƒì„±</h4>
<pre class="java"><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsDynamoDbMapperTestToLearn</span> {</span>
    <span class="hljs-keyword">private</span> AmazonDynamoDB amazonDynamoDb;
    <span class="hljs-keyword">private</span> DynamoDBMapper dynamoDbMapper;

    @<span class="hljs-function">BeforeEach
    <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
        AWSCredentials awsCredentials = <span class="hljs-keyword">new</span> BasicAWSCredentials(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"key2"</span>);
        AWSCredentialsProvider awsCredentialsProvider = <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(awsCredentials);
        EndpointConfiguration endpointConfiguration = <span class="hljs-keyword">new</span> EndpointConfiguration(<span class="hljs-string">"http://localhost:8000"</span>, <span class="hljs-string">"ap-northeast-2"</span>);

        amazonDynamoDb = AmazonDynamoDBClientBuilder.standard()
                .withCredentials(awsCredentialsProvider)
                  .withEndpointConfiguration(endpointConfiguration).build();;

        dynamoDbMapper = <span class="hljs-keyword">new</span> DynamoDBMapper(amazonDynamoDb, DynamoDBMapperConfig.DEFAULT);
    }

    @Test
    @<span class="hljs-function">Disabled
    <span class="hljs-keyword">void</span> <span class="hljs-title">createTable_ValidInput_TableHasBeenCreated</span><span class="hljs-params">()</span> </span>{
        CreateTableRequest createTableRequest = dynamoDbMapper.generateCreateTableRequest(Comment.class)
                .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1L</span>, <span class="hljs-number">1L</span>));

        createTableRequest.getGlobalSecondaryIndexes().forEach(
                idx -&gt; idx
                        .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1L</span>, <span class="hljs-number">1L</span>))
                        .withProjection(<span class="hljs-keyword">new</span> Projection().withProjectionType(<span class="hljs-string">"ALL"</span>))
        );
        then(TableUtils.createTableIfNotExists(amazonDynamoDb, createTableRequest)).isTrue();
    }
}</code></pre>
<p><code class="hljs">AmazonDynamoDB</code>ê°ì²´ë¥¼ í†µí•´ì„œ í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•  <code class="hljs">DynamoDBMapper</code>ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ê°ì²´ë¥¼ í†µí•´ì„œ í…Œì´ë¸” ë§¤í•‘ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code class="hljs">dynamoDbMapper.generateCreateTableRequest(Comment.class)</code>ëŠ” ì´ì „ì— ì •ì˜í•œ <code class="hljs">Comment</code> í´ë˜ìŠ¤ë¥¼ í†µí•´ì„œ í…Œì´ë¸” ìƒì„± ì¿¼ë¦¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.</p>
<p>í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì¥ë ¬íˆ ì‹¤íŒ¨í•˜ëŠ”ë°, <code class="hljs">DynamoDBMapper</code>ë¥¼ ìœ„í•´ ì—”í‹°í‹°ì— ì ë‹¹í•œ ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>
<h4 id="entityì—-annotaiton-ì¶”ê°€í•˜ê¸°">Entityì— Annotaiton ì¶”ê°€í•˜ê¸°</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span> <span class="hljs-comment">// Setters are used in aws-dynamodb-sdk</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@DynamoDBTable</span>(tableName = <span class="hljs-string">"Comment"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Comment {
    <span class="hljs-meta">@DynamoDBHashKey</span>(attributeName = <span class="hljs-string">"id"</span>)
    <span class="hljs-meta">@DynamoDBAutoGeneratedKey</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> id;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-meta">@DynamoDBIndexHashKey</span>(globalSecondaryIndexName = <span class="hljs-string">"byMentionId"</span>)
    <span class="hljs-keyword">private</span> Integer mentionId;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> content;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-meta">@DynamoDBTyped</span>(DynamoDBAttributeType.BOOL)
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> deleted;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-meta">@DynamoDBIndexRangeKey</span>(globalSecondaryIndexName = <span class="hljs-string">"byMentionId"</span>)
    <span class="hljs-keyword">private</span> LocalDateTime createdAt;

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-keyword">private</span> LocalDateTime deletedAt;

  ...
}</code></pre>
<ul>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBTable</span>(tableName = <span class="hljs-string">"Comment"</span>)</code>: í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ì—”í‹°í‹°ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBHashKey</span>(attributeName = <span class="hljs-string">"id"</span>)</code>: í•´ë‹¹ í•„ë“œë¥¼ HashKeyë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBAutoGeneratedKey</span></code>: ìë™ìœ¼ë¡œ Keyë¥¼ ìƒì„±í•©ë‹ˆë‹¤. UUIDë¥¼ í™œìš©í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBAttribute</span></code>: í•´ë‹¹ í•„ë“œë¥¼ Attributeë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBTyped</span>(DynamoDBAttributeType.BOOL)</code>: í•´ë‹¹ íƒ€ì…ì„ DynamoDBì˜ <code class="hljs">BOOL</code>íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBIndexHashKey</span>(globalSecondaryIndexName = <span class="hljs-string">"byMentionId"</span>)</code>: <code class="hljs">byMentionId</code>ë¼ëŠ” ì´ë¦„ì˜ global secondary indexì˜ HashKeyë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li><code class="hljs typescript"><span class="hljs-meta">@DynamoDBIndexRangeKey</span>(globalSecondaryIndexName = <span class="hljs-string">"byMentionId"</span>)</code>: <code class="hljs">byMentionId</code>ë¼ëŠ” ì´ë¦„ì˜ global secondary indexì˜ RangeKeyë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</li>
</ul>
<p>ì´ë ‡ê²Œ ì„¤ì •ì„ í•˜ê³  ë‹¤ì‹œ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ì‹œ í•œ ë²ˆ ì¥ë ¬í•˜ê²Œ ì‹¤íŒ¨í•©ë‹ˆë‹¤â€¦</p>
<pre><code class="hljs vim"><span class="hljs-keyword">com</span>.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMappingException: Comment[createdAt] could not <span class="hljs-keyword">be</span> mapped <span class="hljs-keyword">for</span> <span class="hljs-built_in">type</span> LocalDateTime</code></pre>
<p>ì´ëŠ” Java DynamoDB SDKê°€ Javaì˜ ê¸°ë³¸ <code class="hljs javascript"><span class="hljs-built_in">Date</span></code>íƒ€ì…ë§Œ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì €ëŠ” <code class="hljs">LocalDateTime</code>ì„ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë‹ˆ, <code class="hljs">guestbook-api-comments/src/main/java/guestbook/comments/config/DynamoDbConfig.java</code>í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³  ì´ í´ë˜ìŠ¤ì— <code class="hljs">LocalDateType</code>ì™€ <code class="hljs javascript"><span class="hljs-built_in">Date</span></code>ë¥¼ ìƒí˜¸ ë³€í™˜í•  ìˆ˜ ìˆëŠ” ì»¨ë²„í„°ë¥¼ ì¶”ê°€í•˜ë ¤ê³  í•©ë‹ˆë‹¤. í›—ë‚  <code class="hljs">DynamoDbConfig</code> í´ë˜ìŠ¤ëŠ” spring-data-dynamodbì˜ ì„¤ì •ì„ ìœ„í•´ ì“°ì´ê²Œ ë©ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> DynamoDbConfig {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> LocalDateTimeConverter <span class="hljs-keyword">implements</span> DynamoDBTypeConverter&lt;<span class="hljs-built_in">Date</span>, LocalDateTime&gt; {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">Date</span> convert(LocalDateTime source) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Date</span>.from(source.toInstant(ZoneOffset.UTC));
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> LocalDateTime unconvert(<span class="hljs-built_in">Date</span> source) {
            <span class="hljs-keyword">return</span> source.toInstant().atZone(TimeZone.getDefault().toZoneId()).toLocalDateTime();
        }
    }
}</code></pre>
<p><code class="hljs">LocalDateTime</code>ì€ ì»¨ë²„í„°ë¥¼ í†µí•´ <code class="hljs">UTC</code>ì‹œê°„ì˜ <code class="hljs javascript"><span class="hljs-built_in">Date</span></code>ë¡œ ë³€í™˜ë˜ì–´ DynamoDBì— ì €ì¥ë˜ê³ , ë¶ˆë ¤ì˜¬ ë•ŒëŠ” ì‹œìŠ¤í…œ ì‹œê°„ëŒ€ì˜ <code class="hljs">LocalDateTime</code>ê°ì²´ë¡œ ë³€í™˜ë©ë‹ˆë‹¤. <code class="hljs">LocalDateTime</code>ëŒ€ì‹  <code class="hljs">ZonedDateTime</code>ë„ ë§ˆì°¬ê°€ì§€ì˜ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¨ë²„í„°ì˜ ìœ„ì¹˜ëŠ” ì–´ë””ë“  ìƒê´€ì—†ê¸° ë•Œë¬¸ì— ì»¨ë²„í„°ê°€ ë§ì•„ì§€ë©´ <code class="hljs">DynamoDbConfig</code> í´ë˜ìŠ¤ ë°–ìœ¼ë¡œ ë¹¼ë„ ê´œì°®ê² ìŠµë‹ˆë‹¤.</p>
<p><code class="hljs">LocalDateTime</code> í•„ë“œì— <code class="hljs typescript"><span class="hljs-meta">@DynamoDBTypeConverted</span></code> ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì»¨ë²„í„°ë¥¼ ì—°ê²°í•˜ë©´ í…Œì´ë¸” ìƒì„± í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-comment">// Comment.java</span>
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Comment {
    ...

    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-meta">@DynamoDBIndexRangeKey</span>(globalSecondaryIndexName = <span class="hljs-string">"byMentionId"</span>)
    <span class="hljs-meta">@DynamoDBTypeConverted</span>(converter = LocalDateTimeConverter.class)
    <span class="hljs-keyword">private</span> LocalDateTime createdAt;
    <span class="hljs-meta">@DynamoDBAttribute</span>
    <span class="hljs-meta">@DynamoDBTypeConverted</span>(converter = LocalDateTimeConverter.class)
    <span class="hljs-keyword">private</span> LocalDateTime deletedAt;

    ...</code></pre>
<h4 id="í•­ëª©-ìƒì„±">í•­ëª© ìƒì„±</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> saveItem_ShouldBeCalledAfterTableCreation_IdIsNotNull() {
    Comment comment = Comment.builder()
                .name(<span class="hljs-string">"name"</span>)
                .mentionId(<span class="hljs-number">1</span>)
                .content(<span class="hljs-string">"content"</span>).build();
    then(comment.getId()).isNull();

    dynamoDbMapper.save(comment);
    then(comment.getId()).isNotEmpty();
}</code></pre>
<p>nullì´ì—ˆë˜ idê°€ í•­ëª©ì„ ì €ì¥í•œ ë’¤ì— ì–´ë–¤ ë¬¸ìì—´ë¡œ ì±„ì›Œì¡Œë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. <code class="hljs">Comment</code>ê°ì²´ì˜ ê²½ìš° ì´í›„ì˜ í…ŒìŠ¤íŠ¸ì—ì„œë„ ì¨ì•¼ í•˜ë¯€ë¡œ í…ŒìŠ¤íŠ¸ ë°–ìœ¼ë¡œ ë¹¼ì¤¬ìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs cpp">@SpringBootTest(classes = {DynamoDbConfig.class})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsDynamoDbMapperTestToLearn</span> {</span>
    <span class="hljs-keyword">private</span> AmazonDynamoDB amazonDynamoDb;
    <span class="hljs-keyword">private</span> DynamoDBMapper dynamoDbMapper;
    <span class="hljs-keyword">private</span> Comment comment;

    @<span class="hljs-function">BeforeEach
    <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
        AWSCredentials awsCredentials = <span class="hljs-keyword">new</span> BasicAWSCredentials(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"key2"</span>);
        AWSCredentialsProvider awsCredentialsProvider = <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(awsCredentials);
        EndpointConfiguration endpointConfiguration = <span class="hljs-keyword">new</span> EndpointConfiguration(<span class="hljs-string">"http://localhost:8000"</span>, <span class="hljs-string">"ap-northeast-2"</span>);

        amazonDynamoDb = AmazonDynamoDBClientBuilder.standard()
                .withCredentials(awsCredentialsProvider)
                  .withEndpointConfiguration(endpointConfiguration).build();;

        dynamoDbMapper = <span class="hljs-keyword">new</span> DynamoDBMapper(amazonDynamoDb, DynamoDBMapperConfig.DEFAULT);

        comment = Comment.builder()
                .mentionId(<span class="hljs-number">1</span>)
                .name(<span class="hljs-string">"name"</span>)
                .content(<span class="hljs-string">"content"</span>).build();
    }

    ...</code></pre>
<h4 id="í•­ëª©-ì¡°íšŒ-3">í•­ëª© ì¡°íšŒ</h4>
<pre class="java"><code class="hljs bash">@Test
@Disabled
void <span class="hljs-function"><span class="hljs-title">saveAndLoadItem_ShouldBeCalledAfterTableCreation_FoundItem</span></span>() {
    <span class="hljs-keyword">then</span>(comment.getId()).isNull();
    dynamoDbMapper.save(comment);
    <span class="hljs-keyword">then</span>(comment.getId()).isNotEmpty();

    Comment foundComment = dynamoDbMapper.load(Comment.class, comment.getId());

    <span class="hljs-keyword">then</span>(foundComment)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"id"</span>, comment.getId());
}</code></pre>
<p>idê°€ ì—†ë˜ commentê°ì²´ë¥¼ DynamoDBì— ì €ì¥í•´ ìƒì„±í•œ idë¥¼ í™•ì¸í•˜ê³ , í•´ë‹¹ idë¡œ í•­ëª©ì„ ì°¾ëŠ” í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ìˆ˜ì •-2">í•­ëª© ìˆ˜ì •</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> saveAndUpdateItem_ShouldBeCalledAfterTableCreation_UpdatedItem() {
    <span class="hljs-comment">// given</span>
    then(comment.getId()).isNull();
    dynamoDbMapper.save(comment);
    final <span class="hljs-built_in">String</span> commentId = comment.getId();

    then(commentId).isNotEmpty();
    then(comment).hasFieldOrPropertyWithValue(<span class="hljs-string">"content"</span>, <span class="hljs-string">"content"</span>);

    <span class="hljs-comment">// update and save content</span>
    comment.update(<span class="hljs-string">"modified content"</span>);
    dynamoDbMapper.save(comment);

    <span class="hljs-comment">// then</span>
    Comment foundComment = dynamoDbMapper.load(Comment.class, commentId);
    then(foundComment)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"content"</span>, <span class="hljs-string">"modified content"</span>);
}</code></pre>
<p>ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ í•­ëª© ì¡°íšŒê¹Œì§€ ì„±ê³µí–ˆìœ¼ë¯€ë¡œ, ì´ë²ˆì—” í•œê±¸ìŒ ë” ê°€ì„œ í•­ëª© ìˆ˜ì •ê¹Œì§€ í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì‚­ì œ-3">í•­ëª© ì‚­ì œ</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> saveAndDeleteItem_ShouldBeCalledAfterTableCreation_SameScannedCounts() {
    then(comment.getId()).isNull();
    dynamoDbMapper.save(comment);
    final <span class="hljs-built_in">String</span> commentId = comment.getId();
    then(comment.getId()).isNotEmpty();

    dynamoDbMapper.delete(comment);

    Comment comment = dynamoDbMapper.load(Comment.class, commentId);
    then(comment).isNull();
}</code></pre>
<p>ìƒì„±í•œ í•­ëª©ì˜ idë¥¼ í™•ì¸í•˜ê³ , í•´ë‹¹ ê°ì²´ë¥¼ ì‚­ì œí•œ ë’¤ ì‚­ì œí•œ idì˜ ê°ì²´ë¥¼ ì¡°íšŒí–ˆì„ ë•Œ <code class="hljs javascript"><span class="hljs-literal">null</span></code>ì„ ë¦¬í„´í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</p>
<h4 id="í…Œì´ë¸”-ì‚­ì œ-2">í…Œì´ë¸” ì‚­ì œ</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Disabled</span>
<span class="hljs-built_in">void</span> deleteTable_ShouldBeCalledAfterTableCreation_TableHasBeenCreated() {
    DeleteTableRequest deleteTableRequest = dynamoDbMapper.generateDeleteTableRequest(Comment.class);
    then(TableUtils.deleteTableIfExists(amazonDynamoDb, deleteTableRequest)).isTrue();
}</code></pre>
<p>í…Œì´ë¸”ì„ ìƒì„±í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ <code class="hljs">Comment.class</code>ë¥¼ í†µí•´ ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ì„œ í…Œì´ë¸”ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>DynamoDBMapperëŠ” JPAì˜ EntityManagerì™€ ë¹„ìŠ·í•œ ìœ„ì¹˜ì— ìˆìŠµë‹ˆë‹¤. spring-data-dynamodbì˜ Repositoryë¥¼ í†µí•´ DynamoDBë¥¼ ì¡°ì‘í•˜ë©´ DynamoDBMapperë¥¼ ì§ì ‘ ì¡°ì‘í•˜ì§€ ì•Šê³ ë„ ì—¬ëŸ¬ ì‘ì—…ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="spring-data-dynamodbë¡œ-ì¿¼ë¦¬-ë©”ì„œë“œ-ì‚¬ìš©í•˜ê¸°">spring-data-dynamodbë¡œ ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°</h3>
<p>spring-data-dynamodbì˜ ìµœì‹ ë²„ì „ì€ 5.1.0ì…ë‹ˆë‹¤. ì´ ë²„ì „ë¶€í„° Spring Boot 2.1ì„ ì§€ì›í•˜ì§€ë§Œ <a href="https://github.com/derjust/spring-data-dynamodb/issues/237">ë¬¸ì œê°€ ìˆì–´</a> ì‹¤ì œë¡œëŠ” spring-bootê°€ 2.1.4ë¶€í„° spirng-data-dynamodb 5.1.0ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>spring-bootì˜ ë²„ì „ì´ 2.1.0 ~ 2.1.3ì´ê³ , 2.1.4ë¡œ ì—…ê·¸ë ˆì´ë“œë¥¼ í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì´ë¼ë©´ <a href="https://github.com/derjust/spring-data-dynamodb/issues/237#issuecomment-479441579"><code class="hljs">dynamoDB-DynamoDBMapper</code> ë¹ˆì„ ì§ì ‘ ì •ì˜í•´ ì˜¤ë²„ë¼ì´ë”©í•˜ëŠ” ë°©ë²•</a>ìœ¼ë¡œ spring-data-dynamodb 5.1.0ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>spring-boot 2.0ëŒ€ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, spring-data-dynamodb 5.0.4ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. spring-data-dynamodbì˜ ë²„ì „ì— ë”°ë¼ ì„¤ì •ì´ ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤(<a href="https://github.com/myeongjae-kim/guestbook/blob/master-5.0.4/guestbook-api/guestbook-api-comments/src/main/java/guestbook/comments/config/DynamoDbConfig.java">5.0.4</a>, <a href="https://github.com/myeongjae-kim/guestbook/blob/master/guestbook-api/guestbook-api-comments/src/main/java/guestbook/comments/config/DynamoDbConfig.java">5.1.0</a>). 5.1.0ì—ì„œ ì„¤ì •ì´ ì¡°ê¸ˆ ë” ê°„ë‹¨í•´ì¡ŒìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” spring-boot 2.1.4ì™€ spring-data-dynamodb 5.1.0ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p><code class="hljs">guestbook-api-comments/build.gradle</code>ì˜ dependenciesì— <code class="hljs bash">implementation <span class="hljs-string">"com.github.derjust:spring-data-dynamodb:5.1.0"</span></code>ë¥¼ ì¶”ê°€í•˜ê³ , <code class="hljs">guestbook-api-comments/src/main/java/guestbook/comments/config/DynamoDbConfig.java</code>ì— ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-comment">// spring-data-dynamodb 5.1.0</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableDynamoDBRepositories</span>(basePackages = <span class="hljs-string">"guestbook.comments.domain"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> DynamoDbConfig {
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${amazon.dynamodb.endpoint}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> amazonDynamoDbEndpoint;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${amazon.dynamodb.region}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> amazonDynamoDbRegion;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${amazon.aws.accesskey}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> amazonAwsAccessKey;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${amazon.aws.secretkey}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> amazonAwsSecretKey;

    <span class="hljs-meta">@Primary</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DynamoDBMapper dynamoDbMapper(AmazonDynamoDB amazonDynamoDb) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DynamoDBMapper(amazonDynamoDb, DynamoDBMapperConfig.DEFAULT);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DynamoDBMapper dynamoDBMapper(AmazonDynamoDB amazonDynamoDb, DynamoDBMapperConfig config) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DynamoDBMapper(amazonDynamoDb, config);
    }

    <span class="hljs-meta">@Bean</span>(name = <span class="hljs-string">"amazonDynamoDB"</span>)
    <span class="hljs-keyword">public</span> AmazonDynamoDB amazonDynamoDb() {
        AWSStaticCredentialsProvider credentialsProvider = <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(
                <span class="hljs-keyword">new</span> BasicAWSCredentials(amazonAwsAccessKey, amazonAwsSecretKey));
        EndpointConfiguration endpointConfiguration =
                <span class="hljs-keyword">new</span> EndpointConfiguration(amazonDynamoDbEndpoint, amazonDynamoDbRegion);

        <span class="hljs-keyword">return</span> AmazonDynamoDBClientBuilder.standard()
                .withCredentials(credentialsProvider)
                .withEndpointConfiguration(endpointConfiguration).build();
    }

    <span class="hljs-comment">// LocalDateTime Converter ìƒëµ</span>
}</code></pre>
<p><code class="hljs">DynamoDbConfig</code>í´ë˜ìŠ¤ì— <code class="hljs typescript"><span class="hljs-meta">@Configuration</span></code>ê³¼ <code class="hljs typescript"><span class="hljs-meta">@EnableDynamoDBRepositories</span></code>ë¥¼ ë‹¬ì•„ì£¼ê³  Beanë“¤ì„ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤. <code class="hljs typescript"><span class="hljs-meta">@Value</span></code> ì• ë…¸í…Œì´ì…˜ì— í•„ìš”í•œ ê°’ë“¤ì€ <code class="hljs">guestbook-api-comments/src/main/resources/application.yml</code>ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="yml"><code class="hljs vim">amazon:
  dynamod<span class="hljs-variable">b:</span>
    endpoin<span class="hljs-variable">t:</span> <span class="hljs-string">"http://localhost:8000"</span>
    region: <span class="hljs-string">"ap-northeast-2"</span>
  aw<span class="hljs-variable">s:</span>
    accesskey: <span class="hljs-string">"key"</span>
    secretkey: <span class="hljs-string">"key2"</span></code></pre>
<p><code class="hljs typescript"><span class="hljs-meta">@Primary</span></code>ê°€ ë‹¬ë ¤ìˆëŠ” <code class="hljs">DynamoDBMapper</code> Beanì€ ì‚¬ì‹¤ spring-data-dynamodb ë‚´ë¶€ì—ì„œ <code class="hljs">dynamoDB-DynamoDBMapper</code>ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì•Œì•„ì„œ ìƒì„±í•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ <code class="hljs">CommentRepository</code>ë§Œìœ¼ë¡œëŠ” í…Œì´ë¸”ì„ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— <code class="hljs typescript"><span class="hljs-meta">@Primary</span></code>ë¥¼ ë¶™ì—¬ ì¬ì •ì˜í•´ ìš°ë¦¬ê°€ ì§ì ‘ <code class="hljs">DynamoDBMapper</code>ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. í…Œì´ë¸” ìƒì„±, ì‚­ì œë¥¼ í•˜ì§€ ì•Šì•„ë„ ë˜ë©´ <code class="hljs">DynamoDBMapper</code>ë¥¼ ì¬ì •ì˜í•˜ì§€ ì•Šì•„ë„ ë í…Œë‹ˆ ë” ì¢‹ê² ë„¤ìš”.</p>
<h4 id="í…Œì´ë¸”-ìƒì„±-ì‚­ì œ-ë°-í•­ëª©-ì¶”ê°€">í…Œì´ë¸” ìƒì„±, ì‚­ì œ ë° í•­ëª© ì¶”ê°€</h4>
<p>ê¸°ì¡´ì— ì‘ì„±ë˜ì–´ìˆë˜ <code class="hljs">CommentRepository</code> í´ë˜ìŠ¤ëŠ” <code class="hljs">DynamoDbConfig</code>ì˜ <code class="hljs typescript"><span class="hljs-meta">@EnableDynamoDBRepositories</span>(basePackages = <span class="hljs-string">"guestbook.comments.domain"</span>)</code> ë•ë¶„ì— ì•„ë¬´ëŸ° ìˆ˜ì • ì—†ì´ë„ DynamoDBì˜ Repositoryê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. RepositoryTestë¥¼ ì‘ì„±í•´ í…Œì´ë¸”ì„ ìƒì„±í•´ë´…ì‹œë‹¤.</p>
<p><code class="hljs bash">guestbook-api-comments/src/<span class="hljs-built_in">test</span>/java/guestbook/comments/domain/CommentRepositoryTest.java</code>ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@SpringBootTest</span>(classes = {DynamoDbConfig.class})
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> CommentRepositoryTest {
    <span class="hljs-keyword">private</span> <span class="hljs-meta">@Autowired</span> CommentRepository commentRepository;
    <span class="hljs-keyword">private</span> <span class="hljs-meta">@Autowired</span> AmazonDynamoDB amazonDynamoDb;
    <span class="hljs-keyword">private</span> <span class="hljs-meta">@Autowired</span> DynamoDBMapper dynamoDbMapper;

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> It is weired to create and delete table for each test. Refactor it somehow...</span>
    <span class="hljs-meta">@BeforeEach</span>
    <span class="hljs-built_in">void</span> createTable() {
        CreateTableRequest createTableRequest = dynamoDbMapper.generateCreateTableRequest(Comment.class)
                .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1</span>L, <span class="hljs-number">1</span>L));

        createTableRequest.getGlobalSecondaryIndexes().forEach(
                idx -&gt; idx
                        .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">1</span>L, <span class="hljs-number">1</span>L))
                        .withProjection(<span class="hljs-keyword">new</span> Projection().withProjectionType(<span class="hljs-string">"ALL"</span>))
        );
        TableUtils.createTableIfNotExists(amazonDynamoDb, createTableRequest);
    }

    <span class="hljs-meta">@AfterEach</span>
    <span class="hljs-built_in">void</span> deleteTable() {
        DeleteTableRequest deleteTableRequest = dynamoDbMapper.generateDeleteTableRequest(Comment.class);
        TableUtils.deleteTableIfExists(amazonDynamoDb, deleteTableRequest);
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-built_in">void</span> createComment_ValidInput_CreatedComment() {
        Comment createdComment = commentRepository.save(Comment.builder()
                .mentionId(<span class="hljs-number">1</span>)
                .name(<span class="hljs-string">"name"</span>)
                .content(<span class="hljs-string">"content"</span>).build());

        then(createdComment)
                .hasNoNullFieldsOrPropertiesExcept(<span class="hljs-string">"deletedAt"</span>)
                .hasFieldOrPropertyWithValue(<span class="hljs-string">"mentionId"</span>, <span class="hljs-number">1</span>)
                .hasFieldOrPropertyWithValue(<span class="hljs-string">"name"</span>, <span class="hljs-string">"name"</span>)
                .hasFieldOrPropertyWithValue(<span class="hljs-string">"content"</span>, <span class="hljs-string">"content"</span>);
    }
}</code></pre>
<p><code class="hljs typescript"><span class="hljs-meta">@SpringBootTest</span>(classes = {DynamoDbConfig.class})</code> ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ì„œ ì´ì „ì— ì‘ì„±í–ˆë˜ Configì˜ Beanë“¤ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œë¶€í„° ì‘ì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ëŠ” í…ŒìŠ¤íŠ¸ ìŠˆíŠ¸ì— í¬í•¨ë  í…Œë‹ˆ ì¢€ ë” ì‹ ê²½ì¨ì„œ ì‘ì„±í•˜ë ¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ <code class="hljs">DynamoDBMapper</code> í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ì„œ ì‚¬ìš©í–ˆë˜ í…Œì´ë¸” ìƒì„± ì½”ë“œì™€ ì‚­ì œ ì½”ë“œë¥¼ ë§¤ í…ŒìŠ¤íŠ¸ì˜ ì‹œì‘ê³¼ ëì— ì‹¤í–‰í•˜ë„ë¡ í–ˆëŠ”ë°, ë§¤ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ í…Œì´ë¸”ì„ ìƒì„±í•˜ê³  ì‚­ì œí•˜ëŠ” ê²ƒì€ ë°”ëŒì§í•˜ì§€ ì•Šìœ¼ë‹ˆ ë¯¸ë˜ì˜ ìì‹ ì´ ë¦¬íŒ©í† ë§í•  ê²ƒì´ë¼ ê¸°ëŒ€í•˜ë©´ì„œ TODOë¡œ ê¸°ìˆ ë¶€ì±„ë¥¼ ìŒ“ì•„ì¤ì‹œë‹¤.</p>
<h4 id="í•­ëª©-ì¡°íšŒ-4">í•­ëª© ì¡°íšŒ</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-built_in">void</span> findCreatedComment_ById_FoundComment() {
    <span class="hljs-comment">// given</span>
    <span class="hljs-built_in">String</span> id = commentRepository.save(Comment.builder()
            .mentionId(<span class="hljs-number">1</span>)
            .name(<span class="hljs-string">"name"</span>)
            .content(<span class="hljs-string">"content"</span>).build()
    ).getId();

    <span class="hljs-comment">// when</span>
    Comment foundComment = commentRepository.findById(id)
            .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> CommentNotFoundException(id));

    <span class="hljs-comment">// then</span>
    then(foundComment)
            .hasNoNullFieldsOrPropertiesExcept(<span class="hljs-string">"deletedAt"</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"mentionId"</span>, <span class="hljs-number">1</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"name"</span>, <span class="hljs-string">"name"</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"content"</span>, <span class="hljs-string">"content"</span>);
}</code></pre>
<p>í•­ëª©ì„ ì €ì¥í•´ì„œ ìƒì„±í•œ idë¡œ ì¡°íšŒë¥¼ í•©ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ìˆ˜ì •-3">í•­ëª© ìˆ˜ì •</h4>
<pre class="java"><code class="hljs typescript"><span class="hljs-meta">@Test</span>
<span class="hljs-built_in">void</span> updateComment_ValidInput_UpdatedComment() {
    <span class="hljs-comment">// given</span>
    <span class="hljs-built_in">String</span> id = commentRepository.save(Comment.builder()
            .mentionId(<span class="hljs-number">1</span>)
            .name(<span class="hljs-string">"name"</span>)
            .content(<span class="hljs-string">"content"</span>).build()
    ).getId();

    <span class="hljs-comment">// when</span>
    Comment foundComment = commentRepository.findById(id)
            .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> CommentNotFoundException(id));
    foundComment.update(<span class="hljs-string">"updated content"</span>);
    Comment modifiedComment = commentRepository.save(foundComment);

    <span class="hljs-comment">// then</span>
    then(modifiedComment)
            .hasNoNullFieldsOrPropertiesExcept(<span class="hljs-string">"deletedAt"</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"mentionId"</span>, <span class="hljs-number">1</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"name"</span>, <span class="hljs-string">"name"</span>)
            .hasFieldOrPropertyWithValue(<span class="hljs-string">"content"</span>, <span class="hljs-string">"updated content"</span>);
}</code></pre>
<p>í•­ëª©ì„ ì €ì¥í•´ì„œ ìƒì„±í•œ idë¡œ í•­ëª©ì„ ì¡°íšŒí•œ ë’¤ contentë¥¼ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ ì €ì¥ì„ í•©ë‹ˆë‹¤.</p>
<h4 id="í•­ëª©-ì‚­ì œ-4">í•­ëª© ì‚­ì œ</h4>
<pre class="java"><code class="hljs cpp">@<span class="hljs-function">Test
<span class="hljs-keyword">void</span> <span class="hljs-title">deleteCreatedComment_TryToFindDeletedComment_ThrowCommentNotFoundException</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// given</span>
    Comment createdComment = commentRepository.save(Comment.builder()
            .mentionId(<span class="hljs-number">1</span>)
            .name(<span class="hljs-string">"name"</span>)
            .content(<span class="hljs-string">"content"</span>).build());

    <span class="hljs-comment">// when</span>
    commentRepository.<span class="hljs-keyword">delete</span>(createdComment);

    <span class="hljs-comment">// then</span>
    thenThrownBy(() -&gt; commentRepository.findById(createdComment.getId())
            .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> CommentNotFoundException(createdComment.getId())))
            .isExactlyInstanceOf(CommentNotFoundException.class);
}</code></pre>
<p>ì‚­ì œí•œ í•­ëª©ì„ ë‹¤ì‹œ ì¡°íšŒí•˜ë ¤ê³  í•  ë•Œ <code class="hljs">CommentNotFoundException</code>ì´ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</p>
<h4 id="findallbymentionidorderbycreatedatasc-í…ŒìŠ¤íŠ¸">findAllByMentionIdOrderByCreatedAtAsc í…ŒìŠ¤íŠ¸</h4>
<p>ë“œë””ì–´ ì¿¼ë¦¬ ë©”ì„œë“œê¹Œì§€ ì™”ìŠµë‹ˆë‹¤. <code class="hljs">CommentRepository</code>ì— ì •ì˜í•œ ì´ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì§€ ì•Šê³ ë„ ë³µì¡í•œ ëª…ë ¹ì„ DynamoDBì— ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¿¼ë¦¬ ë©”ì„œë“œì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì„œë‘ì— ì†Œê°œí•œ <a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9788960777330&amp;orderClick=LEA&amp;Kc=">ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°</a>ì„ ì°¸ì¡°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p>
<p>ì§€ê¸ˆ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” ë©”ì„œë“œëŠ” ê°™ì€ <code class="hljs">mentionId</code>ë¥¼ ê°€ì§„ ëŒ“ê¸€ì„ ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•´ì„œ ë¦¬í„´í•©ë‹ˆë‹¤. <code class="hljs">Comment</code> í´ë˜ìŠ¤ì— ì„¤ì •í–ˆë˜ global secondary indexê°€ ì´ë•Œ DynamoDB ë‚´ë¶€ì—ì„œ ì“°ì…ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs cpp">@<span class="hljs-function">Test
<span class="hljs-keyword">void</span> <span class="hljs-title">findComments_ByMentionIdAndOrderByCreatedAtDescDeletedFalse_FoundCommentsInDesignatedOrder</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// given</span>
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">10</span>;
    IntStream.range(<span class="hljs-number">0</span>, size).forEach(i -&gt; commentRepository.save(Comment.builder()
            .mentionId(<span class="hljs-number">1</span>)
            .name(<span class="hljs-string">"name "</span> + i)
            .content(<span class="hljs-string">"content "</span> + i).build()));

    <span class="hljs-comment">// when</span>
    List&lt;Comment&gt; foundComment = commentRepository
            .findAllByMentionIdOrderByCreatedAtAsc(<span class="hljs-number">1</span>);

    <span class="hljs-comment">// then</span>
    then(foundComment.size()).isEqualTo(size);
    IntStream.range(<span class="hljs-number">1</span>, size).forEach(i -&gt; {
        Comment prev = foundComment.get(i - <span class="hljs-number">1</span>);
        Comment next = foundComment.get(i);
        then(prev.getCreatedAt().isBefore(next.getCreatedAt())).isTrue();
    });
}</code></pre>
<p>Repository í…ŒìŠ¤íŠ¸ê¹Œì§€ ì¶”ê°€í–ˆìœ¼ë‹ˆ í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ëª¨ë“  ë ˆì–´ì´ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ë‹ˆë‹¤. ì €ëŠ” <a href="https://github.com/myeongjae-kim/guestbook/blob/complete-first-chapter/guestbook-api/guestbook-api-comments/src/integrationTest/java/guestbook/comments/api/CommentControllerIntTest.java"><code class="hljs">guestbook-api-comments/src/integrationTest/java/guestbook/comments/api/CommentControllerIntTest.java</code>ì— í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤</a>.</p>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ë™ì„ ì‹¤ì œë¡œ í™•ì¸í•˜ì§„ ì•Šì•˜ì–´ë„ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ í”„ë¡œê·¸ë¨ì´ ì œëŒ€ë¡œ ëŒì•„ê°ˆ ê²ƒì´ë¼ëŠ” í™•ì‹ ì„ ê°€ì§ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë¶ˆ-í¸â€¦í•œ ë¶€ë¶„ì´, ì„œë²„ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ” ë¬¼ë¡  í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ì„œë„ ìˆ˜ë™ìœ¼ë¡œ DynamoDBë¥¼ ì‹¤í–‰í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. 2ë¶€ì—ì„œëŠ” Gradleì„ í†µí•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê±°ë‚˜ í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œ DynamoDBë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰Â·ì¢…ë£Œí•´ë³´ë„ë¡ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
</div></article><hr data-v-561bbc92=""><div data-v-561bbc92="" id="adjacent-articles"><!----><div data-v-561bbc92="" id="prev-article"><h4 data-v-561bbc92="">Previous Article</h4><p data-v-561bbc92=""><a data-v-561bbc92="" href="/blog/2019/04/29/name-origin-of-closure-mixin/" class="">[ì±…] âŸ¨ì½”ë”©ì„ ì§€íƒ±í•˜ëŠ” ê¸°ìˆ âŸ©, í´ë¡œì €Closure, ë¯¹ìŠ¤ì¸Mixinì˜ ì–´ì›</a></p></div></div><hr data-v-561bbc92="" style="margin-top: 28px;"><div data-v-561bbc92="" id="share-buttons"><button data-v-561bbc92="" data-clipboard-text="https://blog.myeongjae.kim/2019/06/04/spring-data-dynamodb-1" class="copy-btn">Copy Link</button>
      &nbsp;
      <a data-v-561bbc92="" href="/blog/" class="router-link-active"><button data-v-561bbc92="">Article List</button></a></div><div data-v-561bbc92="" id="disqus_thread"></div></div><a data-v-561bbc92="" class="back-to-top">â†‘</a></div></div><script src="/js/chunk-vendors.855aa201.js"></script><script src="/js/app.a9bc5983.js"></script></body></html>